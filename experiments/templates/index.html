
<html>
<head>
  <title>{{ APPLICATION_NAME }}</title>
  <script type="text/javascript">
  var auth2 = auth2 || {};

  (function() {
    var po = document.createElement('script');
    po.type = 'text/javascript'; po.async = true;
    po.src = 'https://plus.google.com/js/client:plusone.js?onload=startApp';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
  })();
  </script>
  <!-- JavaScript specific to this application that is not related to API
     calls -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" ></script>
</head>
<style>
    #customBtn {
      width: 155px;
    }
    #customBtn:hover {
      box-shadow: 2px 2px 3px #888888;
      border-radius: 5px;
      cursor: hand;
    }
</style>
<body>
  <div id="gConnect" >
    <img id="customBtn" src="/signin_button.png" onClick="signInClick()"
        alt="Sign in with Google+" />
  </div>

    <btn onclick="signInClick()">Sign In</btn>
    <btn onclick="disconnectServer()">Disconnect</btn>
    
</body>
<script type="text/javascript">
    
    function disconnectServer() 
    {
        // Revoke the server tokens
        $.ajax({ type       : 'POST',
                 url        : $(location).attr('origin') + '/disconnect',
                 async      : false,
                 success    : function(result) 
                              { console.log('revoke response: ' + result); },
                 error      : function(e){console.log(e);}
             })
    }
    
    function connectServer(token)
    {
        $.ajax({ type       : 'POST',
                 url        : $(location).attr('origin') + 
                              '/connect?state={{   STATE }}',
                 contentType: 'application/octet-stream; charset=utf-8',
                 success    : function(result){console.log(result);
          
          onSignInCallback(auth2.currentUser.get().getAuthResponse());
        },
        processData: false,
        data: code
      });
        
    }
    
    function connectServer_Callback(result)
    {
        console.log(result);
        onSignInCallback(auth2.currentUser.get().getAuthResponse())
        
        if (authResult['access_token'])
        {
            // The user is signed in
            this.authResult = authResult;

        } 
        else if (authResult['error']) 
        {
            // There was an error, which means the user is not signed in.
            // As an example, you can troubleshoot by writing to the console:
            console.log('There was an error: ' + authResult['error']);
        }
        
        console.log('authResult', authResult);        
    }
    
    
    
    function signInClick() 
    {
        var signIn = function(result) {
      auth2.signIn().then(
        function(googleUser) {
          onSignInCallback(googleUser.getAuthResponse());
        }, function(error) {
          alert(JSON.stringify(error, undefined, 2));
        });
    };

}
    
    
    
var helper = (function() {
  var authResult = undefined;

  return {
    /**
     * Hides the sign-in button and connects the server-side app after
     * the user successfully signs in.
     *
     * @param {Object} authResult An Object which contains the access token and
     *   other authentication information.
     */
    onSignInCallback: function(authResult) {
      $('#authResult').html('Auth Result:<br/>');
      for (var field in authResult) {
        $('#authResult').append(' ' + field + ': ' + authResult[field] + '<br/>');
      }
      if (authResult['access_token']) {
        // The user is signed in
        this.authResult = authResult;

      } else if (authResult['error']) {
        // There was an error, which means the user is not signed in.
        // As an example, you can troubleshoot by writing to the console:
        console.log('There was an error: ' + authResult['error']);
        $('#authResult').append('Logged out');
        $('#authOps').hide('slow');
        $('#gConnect').show();
      }
      console.log('authResult', authResult);
    },

    /**
     * Calls the server endpoint to connect the app for the user. The client
     * sends the one-time authorization code to the server and the server
     * exchanges the code for its own tokens to use for offline API access.
     * For more information, see:
     *   https://developers.google.com/+/web/signin/server-side-flow
     */
    


  };
})();

/**
 * Perform jQuery initialization and check to ensure that you updated your
 * client ID.
 */
$(document).ready(function() {
  $('#disconnect').click(helper.disconnectServer);
  if ($('[data-clientid="YOUR_CLIENT_ID"]').length > 0) {
    alert('This sample requires your OAuth credentials (client ID) ' +
        'from the Google APIs console:\n' +
        '    https://code.google.com/apis/console/#:access\n\n' +
        'Find and replace YOUR_CLIENT_ID with your client ID and ' +
        'YOUR_CLIENT_SECRET with your client secret in the project sources.'
    );
  }
});

/**
 * Called after the Google client library has loaded.
 */
function startApp() {
  gapi.load('auth2', function(){

    // Retrieve the singleton for the GoogleAuth library and setup the client.
    gapi.auth2.init({
        client_id: '{{ CLIENT_ID }}',
        cookiepolicy: 'single_host_origin',
        fetch_basic_profile: false,
        scope: 'https://www.googleapis.com/auth/plus.login'
      }).then(function (){console.log("Login done" });
  });
}

/**
 * Either signs the user in or authorizes the back-end.
 */


</script>
</html>
