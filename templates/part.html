<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Part</title>
        
        <link rel="stylesheet" href="../static/main.css">
        <link rel="stylesheet" href="{{url_for('static', filename='main.css')}}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <script>
            
            var json_data = JSON.parse('{{ data | safe }}');
            
            console.log(" {{ data_obj['@part']['EPN']}} ");
            
            $(document).ready(onLoad);
            
            function bindInteractions()
            {
                
                $("._field_container").hover(
                    function(){$(this).children(".context_field_container").removeClass("hidden");},
                    function(){$(this).children(".context_field_container").addClass("hidden");}
                );
                
                
                $("._category_container").hover(
                    function(){$(this).find(".context_category_container").removeClass("hidden");},
                    function(){$(this).find(".context_category_container").addClass("hidden");}
                )
                
            
            }
            
            function onLoad()
            {                
                console.log(json_data);
                populateParameters();
                $("._field_container").children("input").change( function(){$(this).parent().addClass("edited");});
                bindInteractions();
            }

            
            
            function populateParameters()
            {
                /*
                // Populate part summary fields
                $('#EPN_VALUE').val(  json_data['@part']['EPN']);
                $('#DESCRIPTION_VALUE').val(json_data['@part']['DESCRIPTION']);
                $('#ID_VALUE').val(json_data['_id']);
                $('#MANUFACTURER_VALUE').val(json_data['@part']['MANUFACTURER']);
                $('#MPN_VALUE').val(json_data['@part']['MPN']);
                $('#APPROVAL_VALUE').val(json_data['@part']['APPROVAL']);
                */
                
                /*
                // Iterate through all fields in electrical specs
                for (var item in data['@electrical'])
                {
                    var $div = $("<div>", {class="data_tabs _category_container"});
                    
                    // Check if the field is not private ( _ prefix)
                    if (field.charAt(0) != "_")
                    {
                        // Add a new field to the summary area
                        addNewField(field, data[field])
                    }
                }
                */
            }

            function postUpdates(data, callback)
            {
                $.ajax({type        : "PUT",
                        url         : "/part/ajax/update",
                        data        : JSON.stringify(data, null, '\t'),
                        dataType    : 'json',
                        contentType : 'application/json; charset=UTF-8',
                        complete    : callback,
                        fail        : callback
                        });
            }

            function handleAddNewField()
            {
                addNewField()
            }

            function addNewElectricalSpec(field="Field", value="Value", unit="unit", tolerance="0")
            {
                                
                var new_field = '<div class="asset_summary_field" data-modified="True"><input type="text" class="_key" value='+field+'><input type="text" class="_value" value='+value+'></div>'

                var html = '<div class="_field_container edited" data modified="True">' +
                           '<input type="text" class="_key" value="'+field+'">' +
                           '<input type="text" class="_value" value="'+value+'">' +
                           '<input type="text" class="_unit" value="'+unit+'">' +
                           '<input type="text" class="_tolerance" value="'+tolerance+'">' +
                           '<i class="fa fa-times delete_icon context_button context_field_container hidden"></i>' +
                           '</div>'

                $("#add_new_electrical_button").parent().before(html);
                
                bindInteractions();
            }

            function addNewPhysicalSpec(field="Field", value="Value", unit="unit", tolerance="0")
            {

                var new_field = '<div class="asset_summary_field" data-modified="True"><input type="text" class="_key" value='+field+'><input type="text" class="_value" value='+value+'></div>'

                var html = '<div class="_field_container edited" data modified="True">' +
                           '<input type="text" class="_key" value="'+field+'">' +
                           '<input type="text" class="_value" value="'+value+'">' +
                           '<input type="text" class="_unit" value="'+unit+'">' +
                           '<input type="text" class="_tolerance" value="'+tolerance+'">' +
                           '<i class="fa fa-times delete_icon context_button context_field_container hidden"></i>' +
                           '</div>'

                $("#add_new_physical_button").parent().before(html);
                
                bindInteractions();
            }

            function resp(r)
            {
                console.log(r);
            }

            function handleCommitChanges()
            {
                // Prepare data obj
                post_data = { '@part' : {}, '@electrical' : {}, '@physical' : {}, '_keys' : [] }

                // Iterate function over all asset summary fields
                $("#PART_PROPERTIES").children("._field_container").each(function(i){

                    // Check if the summary field has been modified
                    //if( $(this).children("._value").data("modified") == "True" )
                    if(1)
                    {
                        // Grab key, value from div
                        key     = $(this).children("._key").val();
                        value   = $(this).children("._value").val();
                        unit    = $(this).children("._unit").val();

                        // Add to our data dict
                        post_data['@part'][key] = value;
                    }
                });

                // Iterate function over all asset summary fields
                $("#ELECTRICAL_SPECS").children("._field_container").each(function(i){

                    // Check if the summary field has been modified
                    //if( $(this).children("._value").data("modified") == "True" )
                    if(1)
                    {
                        // Grab key, value from div
                        key     = $(this).children("._key").val();
                        value   = $(this).children("._value").val();
                        unit    = $(this).children("._unit").val();
                        
                        // Add to our data dict
                        post_data['@electrical'][key] = {'value' : value, 'unit' : unit}
                    }
                });


                $("#PHYSICAL_SPECS").children("._field_container").each(function(i){

                    // Check if the summary field has been modified
                    //if( $(this).children("._value").data("modified") == "True" )
                    if(1)
                    {
                        // Grab key, value from div
                        key     = $(this).children("._key").val();
                        value   = $(this).children("._value").val();
                        unit    = $(this).children("._unit").val();

                        // Add to our data dict
                        post_data['@physical'][key] = {'value' : value, 'unit' : unit}
                    }
                });

                // Check if data obj is not empty
                if (1)
                {
                    // Add id to the data
                    post_data['_id'] = json_data["_id"];

                    // Post update to server
                    postUpdates(post_data, function(r){console.log(r);});
                }
                
            }



        </script>
        
    </head>
    <body>
        
        <div class="page">
            <dif class="manf_logo">[manf]</dif>
            <div class="top_nav"><a href="#">user</a> <a href="/part/index">parts</a> <a href="/bom/index">boms</a> </div>        
                <div class="part_summary">
                    
                    <img class="_thumbnail_pic"  src="http://sigma.octopart.com/21441768/image/TE-Connectivity-CRG0402F10K.jpg">
            
                    <div id="PART_PROPERTIES" class="_category_container">
                        <div class="_title" data modified="True">
                            PART PROPERTIES
                        </div>

                        <div class="_field_container" data modified="True">
                            <input type="text" class="_key" value='EPN'>
                            <input type="text" class="_value" id="EPN_VALUE" value="{{data_obj['@part']['EPN']}}">
                        </div>
                        <div class="_field_container" data modified="True">
                            <input type="text" class="_key" value='Description'>
                            <input type="text" class="_value" id="DESCRIPTION_VALUE" value="{{data_obj['@part']['DESCRIPTION']}}">
                        </div>
                        <div class="_field_container" data modified="True">
                            <input type="text" class="_key" value='ID'>
                            <input type="text" class="_value" id="ID_VALUE" value="{{data_obj['_id']}}" readonly=True>
                        </div>
                        <div class="_field_container" data modified="True">
                            <input type="text" class="_key" value='Manufacturer'>
                            <input type="text" class="_value" id="MANUFACTURER_VALUE" value="{{data_obj['@part']['MANUFACTURER']}}">
                        </div>
                        <div class="_field_container" data modified="True">
                            <input type="text" class="_key" value='MPN'>
                            <input type="text" class="_value" id="MPN_VALUE" value="{{data_obj['@part']['MPN']}}">
                        </div>
                        <div class="_field_container" data modified="True">
                            <input type="text" class="_key" value='Approval'>
                            <input type="text" class="_value" id="APPROVAL_VALUE" value="{{data_obj['@part']['APPROVAL']}}">
                        </div>
                    </div>
                </div>
            
            <div class="data_tabs" >
                <div class="_menu">
                    <div class="_item">
                        SPECFICATIONS
                    </div>
                    <div class="_item">
                        COMPLIANCE
                    </div>
                    <div class="_item">
                        DOCUMENTS
                    </div>
                    <div class="_item">
                        ALTERNATIVES
                    </div>
                    <div class="_item">
                        MARKET DATA
                    </div>
                </div>
                
                  
            <div class="_category_container">
                <div class="_title">ELECTRICAL</div>
                <div id="ELECTRICAL_SPECS" class="_field_container" data modified="True">
                    {% for parameter, data in data_obj['@electrical'].iteritems() %}
                        <div class="_field_container" data modified="True">
                            <input type="text" class="_key" value='{{ parameter|e }}'>
                            <input type="text" class="_value" value='{{ data["value"]|e }}'>
                            <select class="_unit">
                                    <option value="Ω"> </option>
                                <optgroup label="Resistance">
                                    <option value="mΩ">mΩ</option>
                                    <option value="Ω">Ω</option>
                                    <option value="KΩ">KΩ</option>
                                    <option value="MΩ">MΩ</option>
                                <optgroup label="Capacitance">
                                    <option value="mΩ">pF</option>
                                    <option value="Ω">nF</option>
                                    <option value="KΩ">μF</option>
                                    <option value="MΩ">mF</option>
                                    <option value="MΩ">F</option>
                                <optgroup label="Inductance">
                                    <option value="mΩ">pH</option>
                                    <option value="Ω">nH</option>
                                    <option value="KΩ">μH</option>
                                    <option value="MΩ">mH</option>
                                    <option value="MΩ">H</option>
                                <optgroup label="Voltage">
                                    <option value="mΩ">pV</option>
                                    <option value="Ω">nV</option>
                                    <option value="KΩ">μV</option>
                                    <option value="MΩ">mV</option>
                                    <option value="MΩ">V</option>
                                    <option value="MΩ">KV</option>
                                    <option value="1">μV/s</option>
                                    <option value="1">mV/s</option>
                                    <option value="1">V/s</option>
                                <optgroup label="Current">
                                    <option value="mΩ">pA</option>
                                    <option value="Ω">nA</option>
                                    <option value="KΩ">μA</option>
                                    <option value="MΩ">mA</option>
                                    <option value="MΩ">A</option>
                                <optgroup label="Power">
                                    <option value="mΩ">pW</option>
                                    <option value="Ω">nW</option>
                                    <option value="KΩ">μW</option>
                                    <option value="MΩ">mW</option>
                                    <option value="MΩ">W</option>
                                    <option value="MΩ">KW</option>
                                    
                                <optgroup label="Charge">
                                    <option value="mΩ">pC</option>
                                    <option value="Ω">nC</option>
                                    <option value="KΩ">μC</option>
                                    <option value="MΩ">mC</option>
                                    <option value="MΩ">C</option>  
                                    <option value="MΩ">KC</option>
                                    <option value="MΩ">MC</option>
                                <optgroup label="Time">
                                    <option value="mΩ">pS</option>
                                    <option value="Ω">nS</option>
                                    <option value="KΩ">μS</option>
                                    <option value="MΩ">mS</option>
                                    <option value="MΩ">Sec</option>
                                    <option value="MΩ">Min</option>
                                    <option value="MΩ">Hrs</option>
                                <optgroup label="Frequency">
                                    <option value="mΩ">mHz</option>
                                    <option value="Ω">Hz</option>
                                    <option value="KΩ">KHz</option>
                                    <option value="MΩ">MHz</option>
                                    <option value="MΩ">GHz</option>
                                    <option value="MΩ">THz</option>
                                <optgroup label="Wavelength">
                                    <option value="mΩ">pm</option>
                                    <option value="Ω">nm</option>
                                    <option value="KΩ">μm</option>
                                    <option value="MΩ">mm</option>
                                    <option value="MΩ">m</option>
                                    <option value="MΩ">km</option>   
                                <optgroup label="Bits">
                                    <option value="mΩ">bit</option>
                                    <option value="Ω">Kbit</option>
                                    <option value="KΩ">Mbit</option>
                                    <option value="MΩ">Gbit</option>
                                    <option value="MΩ">Tbit</option>
                                    <option value="mΩ">bit/s</option>
                                    <option value="Ω">Kbit/s</option>
                                    <option value="KΩ">Mbit/s</option>
                                    <option value="MΩ">Gbit/s</option>
                                    <option value="MΩ">Tbit/s</option>
                                <optgroup label="Bytes">
                                    <option value="mΩ">B</option>
                                    <option value="Ω">KB</option>
                                    <option value="KΩ">MB</option>
                                    <option value="MΩ">GB</option>
                                    <option value="MΩ">TB</option>
                                    <option value="mΩ">B/s</option>
                                    <option value="Ω">KB/s</option>
                                    <option value="KΩ">MB/s</option>
                                    <option value="MΩ">GB/s</option>
                                    <option value="MΩ">TB/s</option>    
                                <optgroup label="Lumnosity">    
                                    <option value="MΩ">mcd</option>
                                    <option value="MΩ">cd</option>
                                    <option value="MΩ">lx</option>
                                    <option value="MΩ">lm</option>
                                <optgroup label="Temperature">
                                    <option value="1">°C</option>
                                    <option value="1">°F</option>
                                    <option value="1">K</option>
                                <optgroup label="Misc">
                                    <option value="a">dB</option>
                                    <option value="1">ppM</option>
                                    <option value="1">ppB</option>
                                    <option value="mΩ">%</option>
                                    <option value="Ω">Ch</option>
                                    <option value="Ω">O/P</option>
                                    <option value="MΩ">mcd</option>
                                    <option value="MΩ">cd</option>
                                    

                                
                            </select>
                            <input type="text" class="_tolerance" value='{{ data["tolerance"] if data["tolerance"] else " " }}'>
                            <i class="fa fa-times delete_icon context_button context_field_container hidden"></i>
                        </div>
                    {% endfor %}
                    
                    <div class="_field_container"><i id="add_new_electrical_button" onclick="addNewElectricalSpec();" class="fa fa-plus-square context_button context_category_container hidden"></i></div>
                </div>
            </div>

            <div class="_category_container">
                <div class="_title">PHYSICAL</div>
                <div id="PHYSICAL_SPECS" class="_field_container" data modified="True">
                    {% for parameter, data in data_obj['@physical'].iteritems() %}
                        <div class="_field_container" data modified="True">
                            <input type="text" class="_key" value='{{ parameter|e }}'>
                            <input type="text" class="_value" value='{{ data["value"]|e }}'>
                            <input type="text" class="_unit" value='{{ data["unit"] }}'>
                            <input type="text" class="_tolerance" value='{{ data["tolerance"] if data["tolerance"] else " " }}'>
                            <i class="fa fa-times delete_icon context_button context_field_container hidden"></i>
                        </div>
                    {% endfor %}
                    
                    <div class="_field_container"><i id="add_new_physical_button" onclick="addNewPhysicalSpec();" class="fa fa-plus-square context_button context_category_container hidden"></i></div>
                </div>
            </div>

                
            </div> <!-- data_tabs -->

        </div> <!-- page -->        
    </body>
</html>
